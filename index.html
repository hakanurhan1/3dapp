<!DOCTYPE html>
<html lang="tr" class="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#0f172a">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>3D Baskı Yöneticisi</title>
    
    <!-- React & Tailwind -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: { sans: ['Outfit', 'sans-serif'] },
                    colors: { primary: '#3b82f6', dark: { bg: '#0f172a', card: '#1e293b', input: '#334155', text: '#f8fafc' } }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Outfit', sans-serif; -webkit-tap-highlight-color: transparent; }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        input[type=number]::-webkit-inner-spin-button, input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; height: 16px; width: 16px; border-radius: 50%; background: #3b82f6; margin-top: -6px; }
        input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 4px; background: #e2e8f0; border-radius: 2px; }
        .dark input[type=range]::-webkit-slider-runnable-track { background: #334155; }
        @keyframes slideUp { from { transform: translateY(100%); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .animate-slide-up { animation: slideUp 0.3s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fadeIn 0.4s ease-out forwards; }
        .progress-bar { transition: width 0.5s ease-in-out; }
        .aspect-video { aspect-ratio: 16 / 9; }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 dark:bg-dark-bg dark:text-dark-text transition-colors duration-300">
<div id="root"></div>

<script type="text/babel">

    // --- ICONS ---
    const Icons = {
        Printer: () => <svg className="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z" /></svg>,
        Cube: () => <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4" /></svg>,
        Zap: () => <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 10V3L4 14h7v7l9-11h-7z" /></svg>,
        Clock: () => <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>,
        Settings: () => <svg className="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" /><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /></svg>,
        Tag: () => <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z" /></svg>,
        Search: () => <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" /></svg>,
        ExternalLink: () => <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" /></svg>,
        Archive: () => <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4" /></svg>,
        Save: () => <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4" /></svg>,
        Upload: () => <svg className="w-8 h-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" /></svg>,
        Trash: () => <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>,
        Copy: () => <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3" /></svg>,
        AlertCircle: () => <svg className="w-8 h-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" /></svg>,
        Moon: () => <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" /></svg>,
        Sun: () => <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" /></svg>,
        Plus: () => <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" /></svg>,
        History: () => <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>,
        Library: () => <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" /></svg>,
        Tool: () => <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" /><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /></svg>,
        Currency: () => <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>,
        Image: () => <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg>,
        Download: () => <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" /></svg>,
        Beaker: () => <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z" /></svg>,
        Calculator: () => <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z" /></svg>,
        FileText: () => <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" /></svg>
    };

    const formatMoney = (val) => new Intl.NumberFormat('tr-TR', { style: 'currency', currency: 'TRY' }).format(val);
    const generateId = () => Date.now().toString(36) + Math.random().toString(36).substr(2);

    // --- HELPERS ---
    const ThemeToggle = ({ isDark, toggle }) => (<button onClick={toggle} className="p-2 rounded-full transition-colors bg-slate-100 hover:bg-slate-200 text-slate-600 dark:bg-slate-800 dark:hover:bg-slate-700 dark:text-slate-300">{isDark ? <Icons.Sun /> : <Icons.Moon />}</button>);
    const InputField = ({ label, value, onChange, unit, icon: Icon, step = "1", type="number", disabled=false }) => (
        <div className="relative group">
            <label className="text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase tracking-wider mb-1.5 block ml-1">{label}</label>
            <div className={`relative flex items-center ${disabled ? 'opacity-60' : ''}`}>
                {Icon && <div className="absolute left-3 text-slate-400 group-focus-within:text-blue-500 transition-colors"><Icon /></div>}
                <input type={type} value={value} onChange={(e) => onChange(e.target.value)} step={step} disabled={disabled} className={`w-full bg-white dark:bg-dark-input text-slate-900 dark:text-white text-lg font-medium rounded-xl border-2 border-slate-100 dark:border-slate-700 focus:border-blue-500 dark:focus:border-blue-500 focus:ring-0 outline-none py-3.5 ${Icon ? 'pl-10' : 'pl-4'} pr-12 shadow-sm transition-all`} placeholder="0" />
                {unit && <div className="absolute right-4 text-sm font-semibold text-slate-400 dark:text-slate-500 bg-slate-50 dark:bg-slate-800 px-2 py-1 rounded-md">{unit}</div>}
            </div>
        </div>
    );
    const DetailRow = ({ label, value, color = "text-slate-800 dark:text-slate-200", bold = false }) => (<div className="flex justify-between items-center py-2 border-b border-slate-50 dark:border-slate-700/50 last:border-0"><span className="text-slate-500 dark:text-slate-400 text-sm">{label}</span><span className={`text-base ${color} ${bold ? 'font-bold' : 'font-medium'}`}>{value}</span></div>);

    // --- STL ANALYZER LOGIC (Pure JS) ---
    const parseSTL = (buffer) => {
        const dataView = new DataView(buffer);
        const isBinary = dataView.getUint32(80, true) > 0; 
        let volume = 0;
        let area = 0;

        if(isBinary) {
            const triangleCount = dataView.getUint32(80, true);
            let offset = 84;
            for (let i = 0; i < triangleCount; i++) {
                const n = { x: dataView.getFloat32(offset, true), y: dataView.getFloat32(offset+4, true), z: dataView.getFloat32(offset+8, true) };
                offset += 12;
                const v1 = { x: dataView.getFloat32(offset, true), y: dataView.getFloat32(offset+4, true), z: dataView.getFloat32(offset+8, true) }; offset+=12;
                const v2 = { x: dataView.getFloat32(offset, true), y: dataView.getFloat32(offset+4, true), z: dataView.getFloat32(offset+8, true) }; offset+=12;
                const v3 = { x: dataView.getFloat32(offset, true), y: dataView.getFloat32(offset+4, true), z: dataView.getFloat32(offset+8, true) }; offset+=12;
                offset += 2; 

                volume += (v1.x*v2.y*v3.z - v1.x*v3.y*v2.z - v2.x*v1.y*v3.z + v2.x*v3.y*v1.z + v3.x*v1.y*v2.z - v3.x*v2.y*v1.z) / 6.0;

                const ab = { x: v2.x - v1.x, y: v2.y - v1.y, z: v2.z - v1.z };
                const ac = { x: v3.x - v1.x, y: v3.y - v1.y, z: v3.z - v1.z };
                const cross = { 
                    x: ab.y * ac.z - ab.z * ac.y,
                    y: ab.z * ac.x - ab.x * ac.z,
                    z: ab.x * ac.y - ab.y * ac.x
                };
                area += 0.5 * Math.sqrt(cross.x*cross.x + cross.y*cross.y + cross.z*cross.z);
            }
        }
        return { volume: Math.abs(volume) / 1000, area: area / 100 }; 
    };

    const estimatePrint = (volumeCm3, areaCm2, infillPercent, walls, supportEnabled) => {
        const density = 1.24; // PLA g/cm3
        const wallThickness = 0.04; // cm
        const layerHeight = 0.02; // cm
        const shellVol = areaCm2 * (walls * wallThickness);
        const innerVol = Math.max(0, volumeCm3 - shellVol);
        const infillVol = innerVol * (infillPercent / 100);
        let totalVol = shellVol + infillVol;
        if(supportEnabled) totalVol *= 1.20;
        const weight = totalVol * density;
        const hoursDecimal = weight / 30; 
        const hours = Math.floor(hoursDecimal);
        const minutes = Math.round((hoursDecimal - hours) * 60);
        return { weight: Math.round(weight), hours, minutes };
    };

    // --- VIEWS ---

    const STLEstimatorView = ({ onEstimateComplete }) => {
        const [file, setFile] = React.useState(null);
        const [infill, setInfill] = React.useState(20);
        const [walls, setWalls] = React.useState(3);
        const [support, setSupport] = React.useState(false);
        const [result, setResult] = React.useState(null);
        const [loading, setLoading] = React.useState(false);

        const handleFile = (e) => {
            const f = e.target.files[0];
            if(f && f.name.toLowerCase().endsWith('.stl')) {
                setFile(f);
                setResult(null);
            } else {
                alert("Lütfen geçerli bir .stl dosyası seçin");
            }
        };

        const calculate = () => {
            if(!file) return;
            setLoading(true);
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const geo = parseSTL(e.target.result);
                    const est = estimatePrint(geo.volume, geo.area, infill, walls, support);
                    setResult(est);
                    onEstimateComplete(est);
                } catch(err) {
                    alert("Dosya analiz edilemedi. Standart Binary STL olduğundan emin olun.");
                }
                setLoading(false);
            };
            reader.readAsArrayBuffer(file);
        };

        return (
            <div className="pb-24 animate-fade-in">
                <div className="bg-white dark:bg-dark-card p-6 rounded-3xl shadow-xl border border-slate-100 dark:border-slate-800">
                    <h2 className="text-2xl font-bold mb-6 dark:text-white flex items-center gap-2"><Icons.Beaker/> STL Analiz & Tahmin</h2>
                    <div className="border-2 border-dashed border-blue-200 dark:border-blue-900 bg-blue-50 dark:bg-blue-900/20 rounded-2xl p-8 text-center relative mb-6 group">
                        <input type="file" accept=".stl" onChange={handleFile} className="absolute inset-0 w-full h-full opacity-0 cursor-pointer" />
                        <div className="flex flex-col items-center gap-3">
                            <div className="p-4 bg-white dark:bg-dark-card rounded-full text-blue-500 shadow-sm group-hover:scale-110 transition-transform"><Icons.Upload /></div>
                            {file ? <p className="font-bold text-blue-600 dark:text-blue-300">{file.name}</p> : <p className="text-slate-500 dark:text-slate-400 font-medium">STL Dosyasını Buraya Sürükle</p>}
                        </div>
                    </div>
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                        <div>
                            <label className="flex justify-between text-sm font-bold text-slate-600 dark:text-slate-300 mb-2">Doluluk (Infill) <span>%{infill}</span></label>
                            <input type="range" min="0" max="100" value={infill} onChange={e=>setInfill(Number(e.target.value))} className="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer" />
                        </div>
                        <div>
                            <label className="flex justify-between text-sm font-bold text-slate-600 dark:text-slate-300 mb-2">Duvar Sayısı <span>{walls}</span></label>
                            <input type="range" min="1" max="10" value={walls} onChange={e=>setWalls(Number(e.target.value))} className="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer" />
                        </div>
                        <div className="flex items-center justify-between bg-slate-50 dark:bg-dark-input p-3 rounded-xl border dark:border-slate-700">
                            <span className="text-sm font-bold text-slate-600 dark:text-slate-300">Destek (Support)</span>
                            <button onClick={()=>setSupport(!support)} className={`w-12 h-6 rounded-full transition-colors relative ${support ? 'bg-blue-600' : 'bg-slate-300'}`}>
                                <div className={`absolute top-1 left-1 w-4 h-4 bg-white rounded-full transition-transform ${support ? 'translate-x-6' : ''}`}></div>
                            </button>
                        </div>
                    </div>
                    <button onClick={calculate} disabled={!file || loading} className="w-full py-4 bg-slate-900 dark:bg-blue-600 text-white rounded-xl font-bold text-lg hover:opacity-90 transition-opacity disabled:opacity-50">{loading ? 'Hesaplanıyor...' : 'Analiz Et ve Hesapla'}</button>
                    {result && (
                        <div className="mt-8 p-6 bg-emerald-50 dark:bg-emerald-900/20 border border-emerald-100 dark:border-emerald-900 rounded-2xl animate-slide-up">
                            <h3 className="text-emerald-800 dark:text-emerald-400 font-bold mb-4 flex items-center gap-2"><Icons.Cube/> Tahmini Sonuçlar</h3>
                            <div className="grid grid-cols-2 gap-4">
                                <div className="bg-white dark:bg-dark-card p-4 rounded-xl shadow-sm"><p className="text-xs text-slate-500 uppercase">Ağırlık</p><p className="text-2xl font-bold text-slate-800 dark:text-white">{result.weight}g</p></div>
                                <div className="bg-white dark:bg-dark-card p-4 rounded-xl shadow-sm"><p className="text-xs text-slate-500 uppercase">Süre</p><p className="text-2xl font-bold text-slate-800 dark:text-white">{result.hours}sa {result.minutes}dk</p></div>
                            </div>
                            <p className="text-xs text-center text-emerald-600 dark:text-emerald-400 mt-4">*Değerler geometrik analizdir. Gerçek dilimleme (Slicing) ayarlarınıza göre +/- %10 değişebilir.</p>
                        </div>
                    )}
                </div>
            </div>
        );
    };

    // --- G-Code Dropzone (Global) ---
    const GCodeDropZone = ({ onFileLoaded }) => {
        const [isDragOver, setIsDragOver] = React.useState(false); const [fileName, setFileName] = React.useState(null); const [error, setError] = React.useState(null);
        const handleDrop = (e) => { e.preventDefault(); setIsDragOver(false); setError(null); if(e.dataTransfer.files[0]) processFile(e.dataTransfer.files[0]); };
        const processFile = (file) => {
            const ext = file.name.split('.').pop().toLowerCase();
            if (['gcode','bgcode'].includes(ext)) {
                setFileName(file.name);
                const reader = new FileReader();
                reader.onload = (e) => {
                    if(ext === 'bgcode') { setError({ title: "Binary GCode", msg: "Lütfen Text G-Code kullanın."}); return; }
                    const text = e.target.result;
                    let tS=0, fG=0;
                    const cT = text.match(/;TIME:(\d+)/); const pT = text.match(/; estimated printing time = (.*)/);
                    if(cT) tS=parseInt(cT[1]); else if(pT) { const h=pT[1].match(/(\d+)h/); const m=pT[1].match(/(\d+)m/); const s=pT[1].match(/(\d+)s/); tS=(h?parseInt(h[1])*3600:0)+(m?parseInt(m[1])*60:0)+(s?parseInt(s[1]):0); }
                    const pW = text.match(/; filament used \[g\] = ([\d\.]+)/); const cW = text.match(/;Filament weight = ([\d\.]+)g/); const oW = text.match(/; total filament used \[g\] = ([\d\.]+)/);
                    if(pW) fG=parseFloat(pW[1]); else if(cW) fG=parseFloat(cW[1]); else if(oW) fG=parseFloat(oW[1]);
                    if(tS===0 && fG===0) setError({title:"Veri Yok", msg:"Dosya okunamadı."}); else onFileLoaded({filamentGrams:fG, timeSeconds:tS});
                };
                reader.readAsText(file);
            } else setError({ title: "Geçersiz", msg: ".gcode gerekli." });
        };
        return (
            <div onDragOver={e=>{e.preventDefault();setIsDragOver(true)}} onDragLeave={()=>setIsDragOver(false)} onDrop={handleDrop} className={`relative border-2 border-dashed rounded-xl p-6 text-center transition-all cursor-pointer mb-6 group ${error?'border-red-300 bg-red-50 dark:bg-red-900/10':(isDragOver?'border-blue-500 bg-blue-50 dark:bg-blue-900/20':'border-slate-200 dark:border-slate-700 hover:border-blue-400 hover:bg-slate-50 dark:hover:bg-slate-800/50')}`}>
                <input type="file" onChange={(e)=>{setError(null); if(e.target.files[0]) processFile(e.target.files[0]);}} accept=".gcode" className="absolute inset-0 w-full h-full opacity-0 cursor-pointer" />
                <div className="flex flex-col items-center gap-2">
                    {error ? <div className="text-red-500"><Icons.AlertCircle /><p className="text-sm font-bold mt-1">{error.title}</p></div> : fileName ? <div className="text-green-600"><Icons.FileText /><p className="text-sm font-bold mt-1">{fileName}</p></div> : <div className="text-slate-400 group-hover:text-blue-500"><Icons.Upload /><p className="text-sm font-medium text-slate-600 dark:text-slate-300 mt-1">G-Code Yükle</p></div>}
                </div>
            </div>
        );
    };

    // --- MAIN APP ---
    function App() {
        const [activeTab, setActiveTab] = React.useState('calculator');
        const [isDark, setIsDark] = React.useState(false);

        const [filamentPrice, setFilamentPrice] = React.useState(500);
        const [spoolWeight, setSpoolWeight] = React.useState(1000);
        const [printWeight, setPrintWeight] = React.useState(50);
        const [power, setPower] = React.useState(300);
        const [elecRate, setElecRate] = React.useState(2.6);
        const [hours, setHours] = React.useState(4);
        const [minutes, setMinutes] = React.useState(30);
        const [markup, setMarkup] = React.useState(50);
        const [failure, setFailure] = React.useState(10);
        const [labor, setLabor] = React.useState(0);
        const [exchangeRate, setExchangeRate] = React.useState(1);
        
        const [cart, setCart] = React.useState([]); 
        const [partName, setPartName] = React.useState("Parça 1");
        const [profiles, setProfiles] = React.useState([]);
        const [inventory, setInventory] = React.useState([]);
        const [history, setHistory] = React.useState([]);
        const [machines, setMachines] = React.useState([]);
        const [savedModels, setSavedModels] = React.useState([]);

        const [showQuoteModal, setShowQuoteModal] = React.useState(false);
        const [showProfileModal, setShowProfileModal] = React.useState(false);
        const [showSaveModelModal, setShowSaveModelModal] = React.useState(false);
        const [profileName, setProfileName] = React.useState("");
        const [customerName, setCustomerName] = React.useState("");
        const [newModelImage, setNewModelImage] = React.useState("");

        React.useEffect(() => {
            const theme = localStorage.getItem('3dPro_Theme');
            if (theme === 'dark' || (!theme && window.matchMedia('(prefers-color-scheme: dark)').matches)) { setIsDark(true); document.documentElement.classList.add('dark'); }
            const s = JSON.parse(localStorage.getItem('3dPro_Settings'));
            if(s) { setFilamentPrice(s.filamentPrice); setSpoolWeight(s.spoolWeight); setPower(s.power); setElecRate(s.elecRate); setMarkup(s.markup); setFailure(s.failure); setLabor(s.labor); if(s.exchangeRate) setExchangeRate(s.exchangeRate); }
            setProfiles(JSON.parse(localStorage.getItem('3dPro_Profiles')) || []);
            setInventory(JSON.parse(localStorage.getItem('3dPro_Inventory')) || []);
            setHistory(JSON.parse(localStorage.getItem('3dPro_History')) || []);
            setMachines(JSON.parse(localStorage.getItem('3dPro_Machines')) || []);
            setSavedModels(JSON.parse(localStorage.getItem('3dPro_SavedModels')) || []);
        }, []);

        React.useEffect(() => { localStorage.setItem('3dPro_Settings', JSON.stringify({ filamentPrice, spoolWeight, power, elecRate, markup, failure, labor, exchangeRate })); }, [filamentPrice, spoolWeight, power, elecRate, markup, failure, labor, exchangeRate]);
        React.useEffect(() => localStorage.setItem('3dPro_Profiles', JSON.stringify(profiles)), [profiles]);
        React.useEffect(() => localStorage.setItem('3dPro_Inventory', JSON.stringify(inventory)), [inventory]);
        React.useEffect(() => localStorage.setItem('3dPro_History', JSON.stringify(history)), [history]);
        React.useEffect(() => localStorage.setItem('3dPro_Machines', JSON.stringify(machines)), [machines]);
        React.useEffect(() => localStorage.setItem('3dPro_SavedModels', JSON.stringify(savedModels)), [savedModels]);

        const toggleTheme = () => { setIsDark(!isDark); document.documentElement.classList.toggle('dark'); localStorage.setItem('3dPro_Theme', !isDark ? 'dark' : 'light'); };

        const calcSingle = (w, h, m) => {
            const adjustedFilamentPrice = filamentPrice * exchangeRate;
            const mat = (adjustedFilamentPrice / spoolWeight) * w;
            const timeH = h + (m/60);
            const en = ((power * timeH) / 1000) * elecRate;
            const lab = labor * timeH;
            const base = mat + en + lab;
            const risk = base * (1 + (failure/100));
            const final = risk * (1 + (markup/100));
            return { mat, en, lab, base, risk, final };
        };

        const currentCalc = calcSingle(printWeight, Number(hours), Number(minutes));

        const cartTotals = React.useMemo(() => {
            let tMat=0, tEn=0, tLab=0, tRisk=0, tFinal=0, tWeight=0;
            const items = cart.length > 0 ? cart : [{...currentCalc, name: partName, weight: printWeight, hours, minutes}];
            items.forEach(i => { const c = i.final ? i : currentCalc; tMat += c.mat; tEn += c.en; tLab += c.lab; tRisk += c.risk; tFinal += c.final; tWeight += (i.weight || printWeight); });
            return { tMat, tEn, tLab, tRisk, tFinal, tWeight, items };
        }, [cart, currentCalc, printWeight, hours, minutes, partName]);

        const addToCart = () => { setCart([...cart, { id: generateId(), name: partName, weight: printWeight, hours: Number(hours), minutes: Number(minutes), ...currentCalc }]); setPartName(`Parça ${cart.length + 2}`); };
        const saveToHistory = () => { setHistory([{ id: generateId(), date: new Date().toLocaleDateString('tr-TR'), customer: customerName || 'İsimsiz', totalPrice: cartTotals.tFinal, itemCount: cartTotals.items.length }, ...history]); alert("İş Geçmişe Kaydedildi!"); };
        const saveModelToLibrary = () => { setSavedModels([...savedModels, { id: generateId(), name: partName, weight: printWeight, hours: Number(hours), minutes: Number(minutes), img: newModelImage }]); setShowSaveModelModal(false); setNewModelImage(""); alert("Model Kütüphaneye Eklendi!"); };
        const loadModelFromLibrary = (modelId) => { const model = savedModels.find(m => m.id === modelId); if(model) { setPartName(model.name); setPrintWeight(model.weight); setHours(model.hours); setMinutes(model.minutes); setActiveTab('calculator'); } };

        const CalculatorView = () => (
            <div className="lg:grid lg:grid-cols-3 lg:gap-8 pb-24">
                <div className="lg:col-span-2 space-y-6">
                    <div className="bg-white dark:bg-dark-card p-1 rounded-xl border border-slate-100 dark:border-slate-800 flex gap-2">
                        <button onClick={()=>setActiveTab('stl_estimate')} className="flex-1 py-3 rounded-lg text-sm font-bold bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-300 border border-blue-100 dark:border-blue-800 flex items-center justify-center gap-2"><Icons.Beaker/> STL Analiz (Tahmin)</button>
                        <div className="flex-1 opacity-50 flex items-center justify-center text-sm text-slate-400 border-l border-slate-200 dark:border-slate-700 pl-2">veya G-Code yükle &darr;</div>
                    </div>
                    <GCodeDropZone onFileLoaded={(r)=>{setPrintWeight(r.filamentGrams); setHours(Math.floor(r.timeSeconds/3600)); setMinutes(Math.floor((r.timeSeconds%3600)/60));}} />
                    <div className="flex gap-2 overflow-x-auto pb-2">
                        <div className="bg-white dark:bg-dark-card p-2 rounded-xl shadow-sm border border-slate-100 dark:border-slate-800 flex gap-2 items-center">
                            <select onChange={(e)=>{const p=profiles.find(x=>x.id===e.target.value); if(p){setFilamentPrice(p.s.filamentPrice); setPower(p.s.power);}}} className="bg-slate-50 dark:bg-dark-input dark:text-white border-none rounded-lg text-sm p-2 min-w-[120px]">
                                <option value="">Profil Yükle...</option>
                                {profiles.map(p=><option key={p.id} value={p.id}>{p.name}</option>)}
                            </select>
                            <button onClick={()=>setShowProfileModal(true)} className="p-2 bg-blue-100 text-blue-600 rounded-lg"><Icons.Save/></button>
                        </div>
                        <button onClick={()=>setActiveTab('library')} className="bg-white dark:bg-dark-card px-4 py-2 rounded-xl shadow-sm border border-slate-100 dark:border-slate-800 flex items-center gap-2 text-sm font-medium text-slate-600 dark:text-slate-300 whitespace-nowrap hover:text-blue-600"><Icons.Library/> Kütüphane</button>
                    </div>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div className="bg-white dark:bg-dark-card p-5 rounded-2xl border border-slate-100 dark:border-slate-800 space-y-4 relative">
                            <div className="flex justify-between items-center"><h3 className="font-bold text-blue-500 text-sm uppercase flex items-center gap-2"><Icons.Cube/> Malzeme & Parça</h3><button onClick={()=>setShowSaveModelModal(true)} className="text-xs bg-blue-50 text-blue-600 px-2 py-1 rounded hover:bg-blue-100">Kaydet</button></div>
                            <InputField label="Parça Adı" type="text" value={partName} onChange={setPartName} />
                            <div className="grid grid-cols-2 gap-3"><InputField label="Filament ($/₺)" value={filamentPrice} onChange={setFilamentPrice} /><InputField label="Kur (1=₺)" value={exchangeRate} onChange={setExchangeRate} step="0.1" icon={Icons.Currency} /></div>
                            <div className="grid grid-cols-1 gap-3"><InputField label="Ağırlık (g)" value={printWeight} onChange={setPrintWeight} /></div>
                        </div>
                        <div className="bg-white dark:bg-dark-card p-5 rounded-2xl border border-slate-100 dark:border-slate-800 space-y-4">
                            <h3 className="font-bold text-amber-500 text-sm uppercase flex items-center gap-2"><Icons.Zap/> Süre & Maliyet</h3>
                            <div className="grid grid-cols-2 gap-3"><InputField label="Saat" value={hours} onChange={setHours} /><InputField label="Dakika" value={minutes} onChange={setMinutes} /></div>
                            <div className="grid grid-cols-3 gap-2"><InputField label="Elektrik" value={elecRate} onChange={setElecRate} step="0.1" /><InputField label="Fire %" value={failure} onChange={setFailure} /><InputField label="Kar %" value={markup} onChange={setMarkup} /></div>
                        </div>
                    </div>
                    <button onClick={addToCart} className="w-full py-4 bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-300 rounded-xl font-bold flex items-center justify-center gap-2 hover:bg-slate-200 dark:hover:bg-slate-700 transition-all border-2 border-dashed border-slate-300 dark:border-slate-600"><Icons.Plus /> Bu Parçayı Listeye Ekle</button>
                    {cart.length > 0 && <div className="bg-white dark:bg-dark-card rounded-2xl p-4 border border-slate-100 dark:border-slate-800"><h3 className="font-bold mb-3 dark:text-white">Proje Listesi ({cart.length})</h3>{cart.map((item, idx) => (<div key={idx} className="flex justify-between items-center p-3 bg-slate-50 dark:bg-dark-input rounded-lg mb-2 text-sm"><span className="font-medium dark:text-slate-200">{item.name} <span className="text-xs text-slate-400">({item.weight}g)</span></span><div className="flex items-center gap-3"><span className="font-bold dark:text-white">{formatMoney(item.final)}</span><button onClick={()=>setCart(cart.filter(x=>x.id!==item.id))} className="text-red-400"><Icons.Trash/></button></div></div>))}</div>}
                </div>
                <div className="hidden lg:block lg:col-span-1">
                    <div className="sticky top-24 bg-white dark:bg-dark-card rounded-3xl p-6 shadow-xl border border-slate-100 dark:border-slate-700">
                        <h3 className="text-lg font-bold dark:text-white mb-6">Toplam Maliyet</h3>
                        <div className="space-y-2 mb-6"><DetailRow label="Malzeme" value={formatMoney(cartTotals.tMat)} /><DetailRow label="Enerji" value={formatMoney(cartTotals.tEn)} /><DetailRow label="İşçilik" value={formatMoney(cartTotals.tLab)} /><div className="h-px bg-slate-100 dark:bg-slate-700 my-2"></div><DetailRow label="Risk Dahil" value={formatMoney(cartTotals.tRisk)} bold /></div>
                        <div className="bg-blue-600 rounded-2xl p-5 text-center text-white mb-4"><p className="text-blue-100 text-xs uppercase font-semibold">Toplam Teklif</p><p className="text-4xl font-bold">{formatMoney(cartTotals.tFinal)}</p></div>
                        <button onClick={()=>setShowQuoteModal(true)} className="w-full bg-slate-900 dark:bg-slate-800 text-white py-3 rounded-xl flex justify-center gap-2"><Icons.FileText /> Teklif Oluştur</button>
                    </div>
                </div>
            </div>
        );

        const LibraryView = () => (
            <div className="animate-fade-in pb-20"><h2 className="text-2xl font-bold mb-6 dark:text-white flex items-center gap-2"><Icons.Library/> Model Kütüphanesi</h2>{savedModels.length>0?<div className="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4">{savedModels.map(m=>(<div key={m.id} className="bg-white dark:bg-dark-card rounded-xl shadow-sm border dark:border-slate-800 p-4"><h3 className="font-bold dark:text-white">{m.name}</h3><p className="text-xs text-slate-500">{m.weight}g • {m.hours}sa {m.minutes}dk</p><button onClick={()=>loadModelFromLibrary(m.id)} className="mt-2 w-full bg-blue-50 text-blue-600 py-2 rounded-lg text-xs font-bold">Yükle</button></div>))}</div>:<p className="text-slate-500">Kütüphane boş.</p>}</div>
        );
        const MachinesView = () => {const [n,sN]=React.useState(""); return <div className="animate-fade-in pb-20"><h2 className="text-2xl font-bold mb-6 dark:text-white flex items-center gap-2"><Icons.Tool/> Makineler</h2><div className="flex gap-2 mb-4"><input value={n} onChange={e=>sN(e.target.value)} placeholder="Makine Adı" className="p-3 border rounded-xl dark:bg-dark-input dark:border-slate-700 dark:text-white flex-1"/><button onClick={()=>{if(n){setMachines([...machines,{id:generateId(),name:n,totalHours:0,maintenanceInterval:200,lastMaintenance:0}]);sN("");}}} className="bg-blue-600 text-white px-6 rounded-xl font-bold">Ekle</button></div><div className="grid gap-4">{machines.map(m=><div key={m.id} className="bg-white dark:bg-dark-card p-4 rounded-xl border dark:border-slate-800"><h4 className="font-bold dark:text-white">{m.name}</h4><p className="text-xs text-slate-500">Toplam: {m.totalHours} Saat</p><button onClick={()=>setMachines(machines.map(x=>x.id===m.id?{...x,totalHours:x.totalHours+5}:x))} className="mt-2 w-full bg-slate-100 dark:bg-slate-800 dark:text-white py-2 rounded-lg text-xs font-bold">+5 Saat Ekle</button></div>)}</div></div>};
        const HistoryView = () => (<div className="animate-fade-in pb-20"><h2 className="text-2xl font-bold mb-6 dark:text-white flex items-center gap-2"><Icons.History/> Geçmiş</h2>{history.map(j=><div key={j.id} className="bg-white dark:bg-dark-card p-4 rounded-xl border dark:border-slate-800 mb-2 flex justify-between"><span className="dark:text-white font-bold">{j.customer}</span><span className="text-blue-600 font-bold">{formatMoney(j.totalPrice)}</span></div>)}</div>);
        const InventoryView = () => {const [n,sN]=React.useState(""); return <div className="animate-fade-in pb-20"><h2 className="text-2xl font-bold mb-6 dark:text-white flex items-center gap-2"><Icons.Archive/> Stok</h2><div className="flex gap-2 mb-4"><input value={n} onChange={e=>sN(e.target.value)} placeholder="Filament Adı" className="p-3 border rounded-xl dark:bg-dark-input dark:border-slate-700 dark:text-white flex-1"/><button onClick={()=>{if(n){setInventory([...inventory,{id:generateId(),name:n}]);sN("");}}} className="bg-blue-600 text-white px-6 rounded-xl font-bold">Ekle</button></div>{inventory.map(i=><div key={i.id} className="bg-white dark:bg-dark-card p-4 rounded-xl border dark:border-slate-800 mb-2 flex justify-between"><span className="dark:text-white">{i.name}</span><button onClick={()=>setInventory(inventory.filter(x=>x.id!==i.id))} className="text-red-500"><Icons.Trash/></button></div>)}</div>};
        const DiscoverView = () => {
            const [searchTerm, setSearchTerm] = React.useState("");
            const handleSearch = (e) => {
                e.preventDefault();
                if(!searchTerm) return;
                window.open(`https://www.thingiverse.com/search?q=${searchTerm}&type=things&sort=relevant`, '_blank');
                window.open(`https://www.printables.com/search/models?q=${searchTerm}`, '_blank');
                window.open(`https://makerworld.com/en/search/models?keyword=${searchTerm}`, '_blank');
            };
            const trendingLinks = [
                { name: "Thingiverse Popüler", url: "https://www.thingiverse.com/explore/popular", color: "bg-blue-500 hover:bg-blue-600", desc: "Topluluk Favorileri" },
                { name: "Printables Trendler", url: "https://www.printables.com/model?o=popular", color: "bg-orange-500 hover:bg-orange-600", desc: "Prusa Topluluğu" },
                { name: "MakerWorld Hot", url: "https://makerworld.com/en/models?orderBy=hot", color: "bg-green-500 hover:bg-green-600", desc: "Bambu Lab" },
                { name: "Cults3D Best", url: "https://cults3d.com/en/creations/popular/ordering/downloads_count", color: "bg-purple-600 hover:bg-purple-700", desc: "Sanatsal Modeller" },
                { name: "Thangs Trending", url: "https://thangs.com/?sort=trending", color: "bg-teal-500 hover:bg-teal-600", desc: "Geometrik Arama" },
                { name: "MyMiniFactory", url: "https://www.myminifactory.com/pages/popular", color: "bg-slate-600 hover:bg-slate-700", desc: "Figür & Oyun" },
            ];

            return (
                <div className="animate-fade-in pb-24">
                    <div className="bg-gradient-to-r from-slate-900 to-slate-800 dark:from-blue-900 dark:to-slate-900 rounded-3xl p-6 sm:p-10 mb-8 text-white relative overflow-hidden shadow-xl">
                        <div className="absolute top-0 right-0 -mr-10 -mt-10 w-40 h-40 bg-white/10 rounded-full blur-2xl"></div>
                        <div className="relative z-10">
                            <h2 className="text-2xl font-bold mb-2">Model Arama Motoru</h2>
                            <p className="text-slate-300 dark:text-slate-200 mb-6 text-sm">Tek tıkla tüm platformlarda arama yapın.</p>
                            <form onSubmit={handleSearch} className="relative max-w-lg">
                                <input type="text" value={searchTerm} onChange={(e) => setSearchTerm(e.target.value)} placeholder="Ne basmak istersin?" className="w-full h-12 pl-12 pr-24 rounded-xl bg-white/10 border border-white/20 text-white placeholder-slate-400 focus:bg-white/20 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all" />
                                <div className="absolute left-4 top-3.5 text-slate-400"><Icons.Search /></div>
                                <button type="submit" className="absolute right-2 top-2 bg-blue-600 hover:bg-blue-500 text-white px-4 py-1.5 rounded-lg text-sm font-medium transition-colors">Ara</button>
                            </form>
                        </div>
                    </div>
                    <h3 className="text-lg font-bold text-slate-900 dark:text-white mb-4 px-1">Canlı Trendler</h3>
                    <div className="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4 mb-8">
                        {trendingLinks.map((l, i) => (
                            <a key={i} href={l.url} target="_blank" className={`block p-5 rounded-2xl shadow-md transition-transform hover:-translate-y-1 text-white ${l.color}`}>
                                <div className="flex justify-between items-start mb-2"><h4 className="font-bold">{l.name}</h4><Icons.ExternalLink /></div>
                                <p className="text-xs text-white/80">{l.desc}</p>
                            </a>
                        ))}
                    </div>
                </div>
            );
        };

        return (
            <div className="min-h-screen pb-safe">
                <div className="sticky top-0 z-30 bg-white/80 dark:bg-dark-bg/80 backdrop-blur-md border-b border-slate-200 dark:border-slate-800">
                    <div className="max-w-5xl mx-auto px-4 h-16 flex items-center justify-between">
                        <div className="flex items-center gap-2 font-bold text-xl dark:text-white"><Icons.Printer /> <span>3D Yönetici</span></div>
                        <div className="flex items-center gap-2">
                             <div className="flex bg-slate-100 dark:bg-slate-800 p-1 rounded-lg overflow-x-auto hide-scrollbar max-w-[200px] sm:max-w-none">
                                {['calculator','stl_estimate','library','machines','inventory','history','discover'].map(t => (
                                    <button key={t} onClick={()=>setActiveTab(t)} className={`p-2 rounded-md transition-all ${activeTab===t ? 'bg-white dark:bg-dark-card shadow text-blue-600' : 'text-slate-500'}`}>
                                        {t==='calculator'?<Icons.Calculator/> : t==='stl_estimate'?<Icons.Beaker/> : t==='library'?<Icons.Library/> : t==='machines'?<Icons.Tool/> : t==='history'?<Icons.History/> : t==='inventory'?<Icons.Archive/> : <Icons.Search/>}
                                    </button>
                                ))}
                             </div>
                             <ThemeToggle isDark={isDark} toggle={toggleTheme} />
                        </div>
                    </div>
                </div>

                <div className="max-w-5xl mx-auto p-4 md:p-6 mt-4">
                    {activeTab === 'calculator' && <CalculatorView />}
                    {activeTab === 'stl_estimate' && <STLEstimatorView onEstimateComplete={(res)=>{ setPrintWeight(res.weight); setHours(res.hours); setMinutes(res.minutes); setActiveTab('calculator'); }} />}
                    {activeTab === 'library' && <LibraryView />}
                    {activeTab === 'machines' && <MachinesView />}
                    {activeTab === 'history' && <HistoryView />}
                    {activeTab === 'inventory' && <InventoryView />}
                    {activeTab === 'discover' && <DiscoverView />}
                </div>
                
                <div clxassName="lg:hidden fixed bottom-0 left-0 right-0 bg-white dark:bg-dark-card border-t dark:border-slate-800 p-4 flex justify-between items-center z-40 safe-bottom">
                    <div><p className="text-xs text-slate-500 uppercase">Toplam</p><p className="text-2xl font-bold dark:text-white">{formatMoney(cartTotals.tFinal)}</p></div>
                    <button onClick={()=>setShowQuoteModal(true)} className="bg-blue-600 text-white px-6 py-3 rounded-xl font-bold">Teklif</button>
                </div>

                {showQuoteModal && <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm"><div className="bg-white dark:bg-dark-card w-full max-w-md rounded-2xl p-6 shadow-2xl"><h3 className="font-bold text-xl mb-4 dark:text-white">Teklif Hazırla</h3><input placeholder="Müşteri Adı" onChange={e=>setCustomerName(e.target.value)} className="w-full p-3 border rounded-xl mb-4 dark:bg-dark-input dark:text-white"/><button onClick={()=>{saveToHistory(); setShowQuoteModal(false);}} className="w-full bg-blue-600 text-white py-3 rounded-xl">Kaydet</button><button onClick={()=>setShowQuoteModal(false)} className="w-full mt-2 text-slate-500">Kapat</button></div></div>}
                {showProfileModal && <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm"><div className="bg-white dark:bg-dark-card w-full max-w-sm rounded-2xl p-6"><h3 className="font-bold mb-4 dark:text-white">Profili Kaydet</h3><input onChange={e=>setProfileName(e.target.value)} placeholder="Örn: Ender 3 - TPU" className="w-full p-3 border rounded-xl mb-4 dark:bg-dark-input dark:text-white"/><button onClick={()=>{setProfiles([...profiles, {id:generateId(), name:profileName, s:{filamentPrice, power}}]); setShowProfileModal(false);}} className="w-full bg-blue-600 text-white py-3 rounded-xl">Kaydet</button><button onClick={()=>setShowProfileModal(false)} className="w-full mt-2 text-slate-500">İptal</button></div></div>}
                {showSaveModelModal && <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm"><div className="bg-white dark:bg-dark-card w-full max-w-sm rounded-2xl p-6"><h3 className="font-bold mb-4 dark:text-white">Modeli Kaydet</h3><input onChange={e=>setNewModelImage(e.target.value)} placeholder="Resim Linki (Opsiyonel)" className="w-full p-3 border rounded-xl mb-4 dark:bg-dark-input dark:text-white"/><button onClick={saveModelToLibrary} className="w-full bg-blue-600 text-white py-3 rounded-xl">Kaydet</button><button onClick={()=>setShowSaveModelModal(false)} className="w-full mt-2 text-slate-500">İptal</button></div></div>}
            </div>
        );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);

</script>
</body>
</html>